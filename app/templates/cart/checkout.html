{% extends "base.html" %}
{% load static %}

{% block content %}
<h1>Checkout</h1>

<form id="checkoutForm">
    <input name="first_name" placeholder="First Name">
    <input name="surname" placeholder="Surname">
    <input name="phone" placeholder="Phone">
    <input name="address" placeholder="Address">
    <input name="mandal" placeholder="Mandal">
    <input name="district" placeholder="District">
    <input name="state" placeholder="State">
    <input name="pincode" placeholder="Pincode">

    <label>Delivery Date</label>
    <input type="date" name="delivery_date">

    <button type="button" onclick="placeOrder()">Place Order</button>
</form>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/cart.js' %}"></script>

<script>
function placeOrder() {
    let form = document.getElementById("checkoutForm");
    let formData = new FormData(form);

    let customer = {};
    formData.forEach((v, k) => customer[k] = v);

    customer.items = getCart();

    fetch("/place-order/", {
        method: "POST",
        body: JSON.stringify(customer)
    }).then(r => r.json())
      .then(res => {
         if(res.status === "success"){
             localStorage.removeItem("onebuild_global_cart_v1");
             window.location.href = "/order-success/";
         } else {
             alert(res.message);
         }
      });
}
</script>
{% endblock %}
