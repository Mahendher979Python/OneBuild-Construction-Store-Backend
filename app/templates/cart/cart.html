{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cart.css' %}">
{% endblock %}

{% block content %}

<h1 class="page-title">Your Cart</h1>

<div id="cart-container"></div>

<div class="checkout-box">
    <h2>Total: ₹<span id="cart-total">0</span></h2>
    <a href="/checkout/" class="btn-checkout">Proceed to Checkout</a>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/cart.js' %}"></script>

<script>
function renderCart() {
    const cart = getCart();
    const box = document.getElementById("cart-container");

    if (cart.length === 0) {
        box.innerHTML = "<p>Your cart is empty.</p>";
        document.getElementById("cart-total").innerText = 0;
        return;
    }

    let html = "";
    let total = 0;

    cart.forEach(item => {
        total += item.qty * item.price;

        html += `
            <div class="cart-item">
                <img src="${item.img}">
                <div class="info">
                    <h3>${item.name}</h3>
                    <p>₹${item.price}</p>
                    <input type="number" value="${item.qty}" onchange="changeQty('${item.id}', this.value)">
                    <button onclick="removeItem('${item.id}')">Remove</button>
                </div>
            </div>
        `;
    });

    box.innerHTML = html;
    document.getElementById("cart-total").innerText = total;
}

function changeQty(id, qty) {
    updateQty(id, parseInt(qty));
    renderCart();
}

function removeItem(id) {
    removeFromCart(id);
    renderCart();
}

document.addEventListener("DOMContentLoaded", () => {
    renderCart();
    updateCartBadge();
});
</script>
{% endblock %}
